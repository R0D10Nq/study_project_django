# Django Landings

Модульная система для создания лендингов на Django с оптимизированной производительностью и безопасностью.

## Структура проекта

```
project/
├── core/                  # Ядро системы
│   ├── chunks/            # Части шаблонов
│   │   ├── queries/       # Оптимизированные запросы к чанкам
│   │   ├── helpers.py     # Хелперы для чанков
│   ├── elist/             # Расширенные списки
│   ├── models.py          # Основные модели
│   ├── templatetags/      # Кастомные теги/фильтры
│   │   ├── assets_tags.py # Теги для оптимизации фронтенда
│   ├── templates/         # Шаблоны
│   ├── middleware.py      # Кастомные middleware
│   ├── utils/             # Утилиты
│   │   ├── landing_utils.py  # Работа с лендингами
│   │   ├── html_utils.py     # Работа с HTML
│   │   ├── cache_utils.py    # Кеширование
│   │   ├── file_utils.py     # Работа с файлами
│   │   ├── assets.py         # Оптимизация CSS/JS
│   │   ├── elist.py          # Класс EditableList
│   │   ├── logger.py         # Система логирования
│   │   └── ...
│   └── ...
├── modules/               # Модульная система
│   ├── _template/         # Шаблон для новых модулей
│   ├── m-about/           # Модуль "О компании"
│   ├── m-benefits/        # Модуль "Преимущества"
│   └── ...
├── _sites/                # Мультисайтовая конфигурация
├── media/                 # Загружаемые файлы
├── static/                # Статические файлы
├── templates/             # Шаблоны проекта
│   ├── base/              # Базовые шаблоны
├── cache/                 # Директория кэширования
│   ├── templates/         # Кэш шаблонов
├── logs/                  # Директория для логов
├── settings.py            # Настройки проекта
├── urls.py                # Маршрутизация
└── ...
```

## Быстрый старт

1. **Запуск в режиме разработки**:
   ```
   dev.bat
   ```
   или
   ```
   python manage.py runserver localhost:8000
   ```

2. **Создание нового модуля**:
   ```
   python create_module.py название-модуля
   ```

## Основные компоненты

### Core

Ядро системы содержит базовые модели, утилиты и шаблоны.

#### Модели

- `Landing` - модель лендинга
- `Page` - модель страницы
- `Chunk` - модель для хранения чанков контента
- `ChunkHistory` - история изменений чанков
- `EList` - редактируемые списки
- `LocalLandingData` - локальные переопределения для лендингов

#### Утилиты

Утилиты разбиты на логические модули в директории `core/utils/`:

- `landing_utils.py` - работа с лендингами
- `html_utils.py` - работа с HTML и шаблонами
- `cache_utils.py` - кеширование
- `file_utils.py` - работа с файлами и изображениями
- `assets.py` - оптимизация CSS/JS ресурсов
- `elist.py` - класс для работы с редактируемыми списками
- `logger.py` - система логирования

### Middleware

- `StaticFilesOptimizationMiddleware` - оптимизация статических файлов
- `XSSProtectionMiddleware` - защита от XSS-атак

### Модули

Система использует модульный подход, где каждый модуль - независимый блок с шаблоном и статическими файлами.

#### Структура модуля

```
modules/m-название/
├── static/
│   ├── css/
│   ├── js/
│   └── img/
├── template.html
└── README.md
```

#### Использование модулей

В шаблонах:
```html
{% module "m-название" variables={"key": "value"} %}
```

### Оптимизация фронтенда

Система автоматически оптимизирует фронтенд с помощью специальных тегов шаблонов:

```html
<!-- Объединение и минификация JS файлов из модуля -->
{% module_js 'm-header' %}

<!-- Объединение и минификация CSS файлов из модуля -->
{% module_css 'm-header' %}

<!-- Ручной выбор файлов для объединения -->
{% combine_js 'm-header' 'script.js' 'additional.js' %}
{% combine_css 'm-header' 'style.css' 'responsive.css' %}

<!-- Версионирование статических файлов -->
<img src="{% versioned_static 'images/logo.png' %}">
```

### Система кэширования

Настроена многоуровневая система кэширования:

1. **Локальное кэширование** - для часто используемых данных
2. **Файловое кэширование** - для кэширования шаблонов
3. **Redis кэширование** - опционально для продакшена

Настройки кэширования можно изменить в `settings.py`.

### Мультисайтовость

Проект поддерживает мультисайтовую архитектуру через директорию `_sites/`, где каждый поддомен имеет свою конфигурацию.

## Разработка

### Безопасность

Внедрены следующие улучшения безопасности:

- Защита от XSS-атак через Content Security Policy
- Валидация ввода для защиты от инъекций
- CSRF-защита для всех форм
- Защищенные cookies и заголовки HTTP

### Логирование

Настроена система логирования с возможностью:

- Записи логов в файлы (`logs/django.log`, `logs/chunks.log`)
- Разделения по уровням важности (DEBUG, INFO, WARNING, ERROR, CRITICAL)
- Специализированных логгеров для разных компонентов

### Тестирование

Запуск тестов:
```
python manage.py test
```

## Оптимизации производительности

1. **Кэширование**:
   - Кэширование чанков и шаблонов
   - Управление заголовками кэширования в браузере

2. **Оптимизация запросов к БД**:
   - Индексы для часто запрашиваемых полей
   - Эффективные запросы с использованием select_related/prefetch_related

3. **Фронтенд оптимизации**:
   - Минификация и объединение JS/CSS
   - Оптимизация загрузки изображений
   - Версионирование статических ресурсов

## Лицензия

Этот проект лицензирован - подробности в файле LICENSE.
